---
import { Image } from "astro:assets";
const {
  data: { title, description, tags, image },
  slug,
  index,
  favorite,
} = Astro.props;

import { slugify } from "@utils/slugify";
---

<article
  class:list={favorite
    ? "flex flex-col justify-between gap-4 p-6 rounded-lg glass"
    : `pill relative ${
        (index + 1) % 3 === 0 ? "flex flex-row" : "flex flex-col"
      } justify-between gap-4 p-6 rounded-lg bg-gradient-to-br from-black to-slate-900 ${
        (index + 1) % 3 === 0
          ? "  md:col-span-2 bg-gradient-to-br from-zinc-950 to-neutral-950"
          : ""
      }`}
>
  {
    (index + 1) % 3 === 0
      ? image && (
          <Image
            class="hidden md:block cover rounded-md"
            src={image}
            width="420"
            height="300"
            format="avif"
            quality={"mid"}
            alt={"Изображение поста " + title}
          />
        )
      : null
  }

  {
    (index + 1) % 3 === 0 ? (
      <>
        <div class="flex flex-col gap-4">
          <h3
            aria-label={title}
            class="pr-3 text-lg hover:underline underline-offset-4 font-bold leading-snug line-clamp-2"
          >
            <a data-saveid={`/posts/${slug}/`} href={`/posts/${slug}/`}>
              {title}
            </a>
          </h3>
          <p
            class={`line-clamp-3 group-hover:text-green-100 leading-relaxed text-gray-400`}
          >
            {description}
          </p>
          <nav class="flex flex-wrap gap-3">
            {tags.map((tag) => {
              let tagClass = tag;

              if (tag === "12 шагов") {
                tagClass = "shagov-12";
              }
              if (tag === "12 традиций") {
                tagClass = "tra-12";
              }
              return (
                <span
                  class={`before:absolute before:left-2 relative pl-6 block text-xs font-medium px-2 py-1 rounded-md ring-current ring-1 ${slugify(
                    tagClass,
                  )}`}
                >
                  {tag}
                </span>
              );
            })}
          </nav>
        </div>
      </>
    ) : (
      <>
        <h3
          aria-label={title}
          class="pr-3 text-lg hover:underline underline-offset-4 font-bold leading-snug line-clamp-2"
        >
          <a data-saveid={`/posts/${slug}/`} href={`/posts/${slug}/`}>
            {title}
          </a>
        </h3>
        <p
          class={`${
            favorite
              ? "text-gray-200"
              : "line-clamp-3 group-hover:text-green-100 leading-relaxed text-gray-400"
          }`}
        >
          {description}
        </p>
        <nav class="flex flex-wrap gap-3">
          {tags.map((tag) => {
            let tagClass = tag;

            if (tag === "12 шагов") {
              tagClass = "shagov-12";
            }
            if (tag === "12 традиций") {
              tagClass = "tra-12";
            }
            return (
              <span
                class={`before:absolute before:left-2 relative pl-6  block text-xs font-medium px-2 py-1 rounded-md ring-current ring-1 ${slugify(
                  tagClass,
                )}`}
              >
                {tag}
              </span>
            );
          })}
        </nav>
      </>
    )
  }

  {
    favorite ?? (
      <button
        class="z-10 absolute top-4 right-4"
        aria-label={title}
        data-saveid={`/posts/${slug}/`}
        aria-pressed="false"
      >
        {""}
      </button>
    )
  }
</article>
