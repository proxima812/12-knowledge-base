---
import BaseLayout from "@layouts/BaseLayout.astro"
import SectionBlur from "@layouts/SectionBlur.astro"
import { settings } from 'src/config'

export const prerender = false;

const response = await fetch(import.meta.env.KEY + `/rest/v1/${settings.site.api_item}`, {
  headers: {
    apikey: import.meta.env.KEY_ANON,
  },
});
const items = await response.json();

interface Props {
  name: string;
  description: string;
  created_at: string;
}
---

<BaseLayout title="Записи">
  <SectionBlur color1="#171949" color2="#49CA9C">
    <div class="grid items-start md:grid-cols-2 gap-5">
      {
        items
          .sort((a, b) => new Date(b.created_at) - new Date(a.created_at))
          .map((item) => (
            <article class="p-5 rounded-lg glass flex flex-col gap-5">
              <h3 class="text-xl font-bold">{item.name}</h3>
              <div class="prose prose-invert line-clamp-5">
                <Fragment set:html={item.description} />
              </div>
              <a
                href={`/alerts/${item.id}`}
                class="px-3 py-1 bg-white text-black font-semibold self-start rounded-md"
              >
                Смотреть
              </a>
            </article>
          ))
      }
    </div>
    <script>
      // Получаем все теги <p> на странице
      const paragraphs = document.getElementsByTagName("p");

      // Проходимся по всем тегам <p>
      for (let i = paragraphs.length - 1; i >= 0; i--) {
        const paragraph = paragraphs[i];

        // Проверяем, если тег <p> пустой
        if (
          paragraph.innerHTML.trim() === "" ||
          paragraph.innerHTML.trim() === "<br>"
        ) {
          // Удаляем пустой тег <p>
          paragraph.parentNode.removeChild(paragraph);
        } else if (paragraph.querySelector("br")) {
          // Если в теге <p> есть <br>, то удаляем его
          paragraph.removeChild(paragraph.querySelector("br"));
        }
      }
    </script>
  </SectionBlur>
</BaseLayout>
